sap.ui.controller("sapui5_using_abap_channels.OpenSalesOrders", {                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
/**                                                                                                                                                                                                                                                            
* Called when a controller is instantiated and its View controls (if available) are already created.                                                                                                                                                           
* Can be used to modify the View before it is displayed, to bind event handlers and do other one-time initialization.                                                                                                                                          
* @memberOf sapui5_using_abap_channels.OpenSalesOrders                                                                                                                                                                                                         
*/                                                                                                                                                                                                                                                             
	onInit: function() {                                                                                                                                                                                                                                          
		var oDunningAnalysisModel;                                                                                                                                                                                                                                   
		                                                                                                                                                                                                                                                             
		//initializaing odata model with gateway odata service url                                                                                                                                                                                                   
		jQuery.sap.require("sap.ui.core.ws.SapPcpWebSocket");                                                                                                                                                                                                        
		//oDunningAnalysisModel = new sap.ui.model.odata.ODataModel("/sap/opu/odata/sap/EPM_OIA_APPS_GW_SERVICE_SRV/");                                                                                                                                              
		//this.oWs = new sap.ui.core.ws.SapPcpWebSocket("/sap/bc/zicf_dunning", sap.ui.core.ws.SapPcpWebSocket.SUPPORTED_PROTOCOLS.v10);                                                                                                                             
		// URL of the web service - IMPORTANT: relative to the server                                                                                                                                                                                                
		var sServiceUrl = "../../../zicf_dunning/DunningLevelDetails";                                                                                                                                                                                               
		oModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                                                  
		//oModel.loadData(sServiceUrl);                                                                                                                                                                                                                              
		var aDataX = { "DunningLevelDetails":                                                                                                                                                                                                                        
						[                                                                                                                                                                                                                                                        
						 {                                                                                                                                                                                                                                                       
							invoice_guid            : "00000000000000000000000000000001" ,                                                                                                                                                                                          
							so_id                   : "0000000001" ,                                                                                                                                                                                                                
							bupa_id                 : "0000001000" ,                                                                                                                                                                                                                
							company_name            : "COMPANY 01" ,                                                                                                                                                                                                                
							days_open               : 10 ,                                                                                                                                                                                                                          
							gross_amount            : "15000.30" ,                                                                                                                                                                                                                  
							currency_code           : "EUR" ,                                                                                                                                                                                                                       
							bupa_rank               : 10 ,                                                                                                                                                                                                                          
							current_dunning_level   : "A" ,                                                                                                                                                                                                                         
							invoice_created_at      : "20160704111111" ,                                                                                                                                                                                                            
							invoice_created_at_date : "20160704"                                                                                                                                                                                                                    
						 }                                                                                                                                                                                                                                                       
						]};                                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
		                                                                                                                                                                                                                                                             
		//Ajax Call with Callback function and JSONP data type                                                                                                                                                                                                       
		//var aData = jQuery.ajax( {&nbsp;                                                                                                                                                                                                                           
		jQuery.ajax( {                                                                                                                                                                                                                                               
			type: "GET",                                                                                                                                                                                                                                                
			contentType: "application/json",                                                                                                                                                                                                                            
			url: sServiceUrl ,                                                                                                                                                                                                                                          
			dataType: "json",                                                                                                                                                                                                                                           
			beforeSend : function(jqXHR, settings )                                                                                                                                                                                                                     
			{                                                                                                                                                                                                                                                           
				//alert("BEFORE SEND");                                                                                                                                                                                                                                    
			} ,                                                                                                                                                                                                                                                         
			                                                                                                                                                                                                                                                            
			success: function(data, textStatus, jqXHR)                                                                                                                                                                                                                  
			{                                                                                                                                                                                                                                                           
//"CONTACTS" is set in class Z_SAPUI5_DATA_MODEL_RESOURCE, method IF_REST_RESOURCE~GET from CALL TRANSFORMATION statement,                                                                                                                                     
//where "SOURCE" clause is the name of the collection that will be created                                                                                                                                                                                     
				oModel.setData({modelData : data});		//data.CONTACTS                                                                                                                                                                                                       
				sap.ui.getCore().setModel(oModel);                                                                                                                                                                                                                         
				//alert("success to post");                                                                                                                                                                                                                                
			} ,                                                                                                                                                                                                                                                         
			                                                                                                                                                                                                                                                            
			error: function( jqXHR, textStatus, errorThrown ) {                                                                                                                                                                                                         
				alert("CALL ERROR <" + textStatus + "><" + errorThrown + ">");                                                                                                                                                                                             
				oModel.setData({modelData : aDataX});                                                                                                                                                                                                                      
				sap.ui.getCore().setModel(oModel);                                                                                                                                                                                                                         
		    } ,                                                                                                                                                                                                                                                      
		&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                                                                     
		    complete: function( jqXHR, textStatus ) {                                                                                                                                                                                                                
		    	//alert("COMPLETE <" + textStatus +">");                                                                                                                                                                                                                
		    	if (textStatus=='error') {                                                                                                                                                                                                                              
		    		sap.ui.getCore().setModel(oModel);                                                                                                                                                                                                                     
		     	}                                                                                                                                                                                                                                                      
		    }                                                                                                                                                                                                                                                        
		});                                                                                                                                                                                                                                                          
		                                                                                                                                                                                                                                                             
		//as count is not needed for this app, disable the count functionality                                                                                                                                                                                       
		//oDunningAnalysisModel.setCountSupported(false);                                                                                                                                                                                                            
		                                                                                                                                                                                                                                                             
		//binding the oData model to core                                                                                                                                                                                                                            
		//sap.ui.getCore().setModel(oDunningAnalysisModel);                                                                                                                                                                                                          
		sap.ui.getCore().setModel(this.oWs);                                                                                                                                                                                                                         
		                                                                                                                                                                                                                                                             
		// call the method init the dunning level change feed                                                                                                                                                                                                        
		this.initDunningRunFeed();                                                                                                                                                                                                                                   
	},                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
/**                                                                                                                                                                                                                                                            
* Similar to onAfterRendering, but this hook is invoked before the controller's View is re-rendered                                                                                                                                                            
* (NOT before the first rendering! onInit() is used for that one!).                                                                                                                                                                                            
* @memberOf sapui5_using_abap_channels.OpenSalesOrders                                                                                                                                                                                                         
*/                                                                                                                                                                                                                                                             
//	onBeforeRendering: function() {                                                                                                                                                                                                                             
//                                                                                                                                                                                                                                                             
//	},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
/**                                                                                                                                                                                                                                                            
* Called when the View has been rendered (so its HTML is part of the document). Post-rendering manipulations of the HTML could be done here.                                                                                                                   
* This hook is the same one that SAPUI5 controls get after being rendered.                                                                                                                                                                                     
* @memberOf sapui5_using_abap_channels.OpenSalesOrders                                                                                                                                                                                                         
*/                                                                                                                                                                                                                                                             
//	onAfterRendering: function() {                                                                                                                                                                                                                              
//                                                                                                                                                                                                                                                             
//	},                                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
/**                                                                                                                                                                                                                                                            
* Called when the Controller is destroyed. Use this one to free resources and finalize activities.                                                                                                                                                             
* @memberOf sapui5_using_abap_channels.OpenSalesOrders                                                                                                                                                                                                         
*/                                                                                                                                                                                                                                                             
//	onExit: function() {                                                                                                                                                                                                                                        
//                                                                                                                                                                                                                                                             
//	}                                                                                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
	initDunningRunFeed : function () {                                                                                                                                                                                                                            
		var hostLocation = window.location, socket, socketHostURI, webSocketURI;                                                                                                                                                                                     
		if (hostLocation.protocol === "https:") {                                                                                                                                                                                                                    
			socketHostURI = "wss:";                                                                                                                                                                                                                                     
		} else {                                                                                                                                                                                                                                                     
			socketHostURI = "ws:";                                                                                                                                                                                                                                      
		}                                                                                                                                                                                                                                                            
		socketHostURI += "//" + hostLocation.host;                                                                                                                                                                                                                   
		webSocketURI = socketHostURI + '/sap/bc/apc/sap/zicf_dunning_apc';                                                                                                                                                                                           
		try {                                                                                                                                                                                                                                                        
			socket = new WebSocket(webSocketURI);                                                                                                                                                                                                                       
			socket.onopen = function(){ };                                                                                                                                                                                                                              
			socket.onmessage = function(dunningRunFeed) {                                                                                                                                                                                                               
				if (dunningRunFeed.data !== undefined ) {                                                                                                                                                                                                                  
					jQuery.sap.require("sap.m.MessageBox");                                                                                                                                                                                                                   
					sap.m.InstanceManager.closeAllDialogs();                                                                                                                                                                                                                  
					sap.m.MessageBox.show(                                                                                                                                                                                                                                    
							dunningRunFeed.data,                                                                                                                                                                                                                                    
							sap.m.MessageBox.Icon.INFORMATION,                                                                                                                                                                                                                      
							"APC Notification",                                                                                                                                                                                                                                     
							[ sap.m.MessageBox.Action.OK ]                                                                                                                                                                                                                          
					);                                                                                                                                                                                                                                                        
				}                                                                                                                                                                                                                                                          
			};                                                                                                                                                                                                                                                          
			socket.onclose = function(){ };                                                                                                                                                                                                                             
		} catch(exception){ }                                                                                                                                                                                                                                        
	}                                                                                                                                                                                                                                                             
});                                                                                                                                                                                                                                                            